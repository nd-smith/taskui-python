============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-9.0.1, pluggy-1.6.0
rootdir: /home/nick/Projects/taskui-python
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: asyncio-1.3.0, cov-7.0.0, Faker-33.3.1, anyio-4.10.0
asyncio: mode=auto, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 490 items

tests/test_app.py .....F....FF...F.F........F.FF...F.....                [  7%]
tests/test_column.py .......F...................F.........F.F..........  [ 18%]
tests/test_column2_updates.py FFFFF...F..                                [ 20%]
tests/test_config.py ...........                                         [ 22%]
tests/test_database.py .................                                 [ 26%]
tests/test_detail_panel.py ............F..                               [ 29%]
tests/test_integration_mvp.py ..FFFF.FF...                               [ 31%]
tests/test_keyboard_navigation.py ...F.................                  [ 35%]
tests/test_list_bar.py .......................                           [ 40%]
tests/test_list_service.py .................F...F                        [ 45%]
tests/test_logging_config.py ...............................             [ 51%]
tests/test_models.py ......................................              [ 59%]
tests/test_persistence.py ..........                                     [ 61%]
tests/test_printer_service.py ..................                         [ 64%]
tests/test_refresh_helper.py ........                                    [ 66%]
tests/test_task_editing.py .........F........                            [ 70%]
tests/test_task_item.py .........F...................................... [ 80%]
......                                                                   [ 81%]
tests/test_task_modal.py .....................                           [ 85%]
tests/test_task_service.py ............................................. [ 94%]
......                                                                   [ 95%]
tests/test_ui_components.py ........F...........                         [100%]

=================================== FAILURES ===================================
_____ TestAppStateManagement.test_focused_column_id_tracks_current_column ______
tests/test_app.py:231: in test_focused_column_id_tracks_current_column
    assert app._focused_column_id == COLUMN_3_ID
E   AssertionError: assert 'column-1' == 'column-3'
E     
E     - column-3
E     ?        ^
E     + column-1
E     ?        ^
_ TestActionMethodsNavigation.test_action_navigate_next_column_cycles_forward __
tests/test_app.py:403: in test_action_navigate_next_column_cycles_forward
    assert app._focused_column_id == COLUMN_3_ID
E   AssertionError: assert 'column-1' == 'column-3'
E     
E     - column-3
E     ?        ^
E     + column-1
E     ?        ^
_ TestActionMethodsNavigation.test_action_navigate_prev_column_cycles_backward _
tests/test_app.py:428: in test_action_navigate_prev_column_cycles_backward
    assert app._focused_column_id == COLUMN_3_ID
E   AssertionError: assert 'column-2' == 'column-3'
E     
E     - column-3
E     ?        ^
E     + column-2
E     ?        ^
_ TestActionMethodsTaskOperations.test_action_new_child_task_requires_selection _
tests/test_app.py:568: in test_action_new_child_task_requires_selection
    assert app.screen == app
E   AssertionError: assert Screen(id='_default') == TaskUI(title='TaskUI - Nested Task Manager', classes={'-dark-mode'}, pseudo_classes={'dark', 'focus'})
E    +  where Screen(id='_default') = TaskUI(title='TaskUI - Nested Task Manager', classes={'-dark-mode'}, pseudo_classes={'dark', 'focus'}).screen
___ TestActionMethodsTaskOperations.test_action_edit_task_requires_selection ___
tests/test_app.py:635: in test_action_edit_task_requires_selection
    assert app.screen == app
E   AssertionError: assert Screen(id='_default') == TaskUI(title='TaskUI - Nested Task Manager', classes={'-dark-mode'}, pseudo_classes={'dark', 'focus'})
E    +  where Screen(id='_default') = TaskUI(title='TaskUI - Nested Task Manager', classes={'-dark-mode'}, pseudo_classes={'dark', 'focus'}).screen
___ TestEventHandlers.test_on_task_creation_modal_task_created_creates_task ____
tests/test_app.py:920: in test_on_task_creation_modal_task_created_creates_task
    tasks = await task_service.get_tasks_for_list(
E   TypeError: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
------------------------------ Captured log call -------------------------------
ERROR    taskui.database:database.py:185 Database session error, rolling back: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
Traceback (most recent call last):
  File "/home/nick/Projects/taskui-python/taskui/database.py", line 182, in get_session
    yield session
  File "/home/nick/Projects/taskui-python/tests/test_app.py", line 920, in test_on_task_creation_modal_task_created_creates_task
    tasks = await task_service.get_tasks_for_list(
TypeError: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
________ TestEventHandlers.test_on_list_bar_list_selected_switches_list ________
tests/test_app.py:1000: in test_on_list_bar_list_selected_switches_list
    list_bar.post_message(ListBar.ListSelected(list_id=second_list_id))
E   TypeError: ListBar.ListSelected.__init__() missing 1 required positional argument: 'list_name'
_________ TestComponentOrchestration.test_modal_to_database_to_ui_flow _________
tests/test_app.py:1050: in test_modal_to_database_to_ui_flow
    tasks = await task_service.get_tasks_for_list(
E   TypeError: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
------------------------------ Captured log call -------------------------------
ERROR    taskui.database:database.py:185 Database session error, rolling back: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
Traceback (most recent call last):
  File "/home/nick/Projects/taskui-python/taskui/database.py", line 182, in get_session
    yield session
  File "/home/nick/Projects/taskui-python/tests/test_app.py", line 1050, in test_modal_to_database_to_ui_flow
    tasks = await task_service.get_tasks_for_list(
TypeError: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
_______ TestUIRefresh.test_refresh_ui_clears_detail_panel_when_requested _______
tests/test_app.py:1242: in test_refresh_ui_clears_detail_panel_when_requested
    await app.action_archive_task()
E   AttributeError: 'TaskUI' object has no attribute 'action_archive_task'. Did you mean: 'action_delete_task'?
_________ TestTaskColumnRendering.test_render_mixed_completion_states __________
tests/test_column.py:137: in test_render_mixed_completion_states
    make_task(title="Archived", is_completed=True, is_archived=True),
E   TypeError: make_task.<locals>._make_task() got an unexpected keyword argument 'is_archived'
___________ TestTaskColumnTaskUpdates.test_empty_to_populated_state ____________
tests/test_column.py:488: in test_empty_to_populated_state
    assert column.get_selected_task() is None  # No selection set yet
E   AssertionError: assert Task(id=UUID('a79a403e-d5e7-480a-bb5f-7d86ce38973a'), title='Task 1', notes=None, is_completed=False, parent_id=None, ...', completion_percentage=0.0, has_children=False, can_have_children_in_column1=True, can_have_children_in_column2=True) is None
E    +  where Task(id=UUID('a79a403e-d5e7-480a-bb5f-7d86ce38973a'), title='Task 1', notes=None, is_completed=False, parent_id=None, ...', completion_percentage=0.0, has_children=False, can_have_children_in_column1=True, can_have_children_in_column2=True) = get_selected_task()
E    +    where get_selected_task = TaskColumn().get_selected_task
_ TestTaskColumnMessageHandling.test_task_selected_message_preserves_task_data _
tests/test_column.py:660: in test_task_selected_message_preserves_task_data
    task = make_task(
tests/conftest.py:259: in _make_task
    return Task(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for Task
E     Value error, Level 1 tasks must have a parent_id [type=value_error, input_value={'id': UUID('f6c14930-aa2...), 'completed_at': None}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/value_error
________ TestTaskColumnGrouping.test_group_tasks_by_parent_hierarchical ________
tests/test_column.py:702: in test_group_tasks_by_parent_hierarchical
    make_task(title="Child 1", parent_id=parent_id),
tests/conftest.py:259: in _make_task
    return Task(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for Task
E     Value error, Level 0 tasks cannot have a parent_id [type=value_error, input_value={'id': UUID('9af8a260-ad1...), 'completed_at': None}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/value_error
__ TestColumn2DynamicUpdates.test_make_levels_context_relative_level_0_parent __
tests/test_column2_updates.py:47: in test_make_levels_context_relative_level_0_parent
    adjusted = app._make_levels_context_relative(tasks, parent_level=0)
E   AttributeError: 'TaskUI' object has no attribute '_make_levels_context_relative'
__ TestColumn2DynamicUpdates.test_make_levels_context_relative_level_1_parent __
tests/test_column2_updates.py:72: in test_make_levels_context_relative_level_1_parent
    adjusted = app._make_levels_context_relative(tasks, parent_level=1)
E   AttributeError: 'TaskUI' object has no attribute '_make_levels_context_relative'
_ TestColumn2DynamicUpdates.test_make_levels_context_relative_preserves_task_data _
tests/test_column2_updates.py:98: in test_make_levels_context_relative_preserves_task_data
    adjusted = app._make_levels_context_relative([task], parent_level=1)
E   AttributeError: 'TaskUI' object has no attribute '_make_levels_context_relative'
____ TestColumn2DynamicUpdates.test_make_levels_context_relative_empty_list ____
tests/test_column2_updates.py:117: in test_make_levels_context_relative_empty_list
    adjusted = app._make_levels_context_relative([], parent_level=0)
E   AttributeError: 'TaskUI' object has no attribute '_make_levels_context_relative'
_ TestColumn2DynamicUpdates.test_make_levels_context_relative_multiple_levels __
tests/test_column2_updates.py:136: in test_make_levels_context_relative_multiple_levels
    adjusted = app._make_levels_context_relative(tasks, parent_level=0)
E   AttributeError: 'TaskUI' object has no attribute '_make_levels_context_relative'
___ TestColumn2SuccessCriteria.test_success_criteria_context_relative_levels ___
tests/test_column2_updates.py:186: in test_success_criteria_context_relative_levels
    adjusted_l0 = app._make_levels_context_relative(tasks_l0, parent_level=0)
E   AttributeError: 'TaskUI' object has no attribute '_make_levels_context_relative'
_________ TestDetailPanelIntegration.test_different_completion_states __________
tests/test_detail_panel.py:288: in test_different_completion_states
    assert "Archived" in text3
E   AssertionError: assert 'Archived' in '[bold #66D9EF]TASK[/bold #66D9EF]\n  Sample Task [#A6E22E]âœ“ Complete[/#A6E22E]\n\n[bold #66D9EF]STATUS[/bold #66D9EF]...[#AE81FF]2025-01-14 12:00:00[/#AE81FF]\n\n[bold #66D9EF]NOTES[/bold #66D9EF]\n  [italic]This is a test task[/italic]\n'
__________ TestMVPIntegration.test_modal_to_database_persistence_flow __________
tests/test_integration_mvp.py:196: in test_modal_to_database_persistence_flow
    tasks = await task_service.get_tasks_for_list(
E   TypeError: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
------------------------------ Captured log call -------------------------------
ERROR    taskui.database:database.py:185 Database session error, rolling back: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
Traceback (most recent call last):
  File "/home/nick/Projects/taskui-python/taskui/database.py", line 182, in get_session
    yield session
  File "/home/nick/Projects/taskui-python/tests/test_integration_mvp.py", line 196, in test_modal_to_database_persistence_flow
    tasks = await task_service.get_tasks_for_list(
TypeError: TaskService.get_tasks_for_list() got an unexpected keyword argument 'include_archived'
_______ TestMVPIntegration.test_nested_task_hierarchy_creation_via_modal _______
tests/test_integration_mvp.py:271: in test_nested_task_hierarchy_creation_via_modal
    assert column2._tasks[0].level == 0  # Context-relative
E   AssertionError: assert 1 == 0
E    +  where 1 = Task(id=UUID('a2371a8b-1b90-4d7b-b240-06f7cc45036c'), title='Child Task', notes=None, is_completed=False, parent_id=UU..., completion_percentage=0.0, has_children=False, can_have_children_in_column1=False, can_have_children_in_column2=True).level
___________ TestMVPIntegration.test_column2_updates_on_task_creation ___________
tests/test_integration_mvp.py:347: in test_column2_updates_on_task_creation
    assert column2._tasks[0].level == 0  # Context-relative
E   AssertionError: assert 1 == 0
E    +  where 1 = Task(id=UUID('b5461c04-d29b-4e70-acd4-303958f12326'), title='Child in Column 2', notes=None, is_completed=False, paren..., completion_percentage=0.0, has_children=False, can_have_children_in_column1=False, can_have_children_in_column2=True).level
____________ TestMVPIntegration.test_all_crud_operations_end_to_end ____________
tests/test_integration_mvp.py:409: in test_all_crud_operations_end_to_end
    assert column1._tasks[0].title == "Updated CRUD Task"
E   AssertionError: assert 'CRUD Test Task' == 'Updated CRUD Task'
E     
E     - Updated CRUD Task
E     + CRUD Test Task
__________ TestMVPIntegration.test_keyboard_navigation_across_columns __________
tests/test_integration_mvp.py:520: in test_keyboard_navigation_across_columns
    assert app._focused_column_id == "column-3"
E   AssertionError: assert 'column-1' == 'column-3'
E     
E     - column-3
E     ?        ^
E     + column-1
E     ?        ^
_________ TestMVPIntegration.test_column2_updates_on_column1_selection _________
tests/test_integration_mvp.py:615: in test_column2_updates_on_column1_selection
    assert len(column2._tasks) == 2
E   AssertionError: assert 3 == 2
E    +  where 3 = len([Task(id=UUID('cce347cf-199b-4645-81c7-a343caf71cb7'), title='Parent 1 Child 1', notes=None, is_completed=False, paren... completion_percentage=0.0, has_children=False, can_have_children_in_column1=False, can_have_children_in_column2=True)])
E    +    where [Task(id=UUID('cce347cf-199b-4645-81c7-a343caf71cb7'), title='Parent 1 Child 1', notes=None, is_completed=False, paren... completion_percentage=0.0, has_children=False, can_have_children_in_column1=False, can_have_children_in_column2=True)] = TaskColumn(id='column-2')._tasks
___________ TestKeybindings.test_letter_keybindings_case_insensitive ___________
tests/test_keyboard_navigation.py:66: in test_letter_keybindings_case_insensitive
    assert "a,A" in binding_dict
E   AssertionError: assert 'a,A' in {'1': 'switch_list_1', '2': 'switch_list_2', '3': 'switch_list_3', '4': 'switch_list_4', ...}
___________ TestListServiceDelete.test_delete_list_cascades_to_tasks ___________
tests/test_list_service.py:250: in test_delete_list_cascades_to_tasks
    task = TaskORM(
<string>:4: in __init__
    ???
../../.local/lib/python3.10/site-packages/sqlalchemy/orm/state.py:564: in _initialize_instance
    with util.safe_reraise():
../../.local/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../.local/lib/python3.10/site-packages/sqlalchemy/orm/state.py:562: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
../../.local/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py:2139: in _declarative_constructor
    raise TypeError(
E   TypeError: 'is_archived' is an invalid keyword argument for TaskORM
___________ TestListServiceTaskCounts.test_get_list_with_task_counts ___________
tests/test_list_service.py:335: in test_get_list_with_task_counts
    task1 = TaskORM(
<string>:4: in __init__
    ???
../../.local/lib/python3.10/site-packages/sqlalchemy/orm/state.py:564: in _initialize_instance
    with util.safe_reraise():
../../.local/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../../.local/lib/python3.10/site-packages/sqlalchemy/orm/state.py:562: in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
../../.local/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py:2139: in _declarative_constructor
    raise TypeError(
E   TypeError: 'is_archived' is an invalid keyword argument for TaskORM
____ TestEditTaskServiceIntegration.test_update_task_preserves_other_fields ____
tests/test_task_editing.py:242: in test_update_task_preserves_other_fields
    assert updated_task.created_at == original_created_at
E   AssertionError: assert datetime.datetime(2025, 11, 21, 16, 18, 6, 516474) == datetime.datetime(2025, 11, 21, 16, 18, 6, 516474, tzinfo=datetime.timezone.utc)
E    +  where datetime.datetime(2025, 11, 21, 16, 18, 6, 516474) = Task(id=UUID('33146a09-a59c-4f9e-8a26-1be1e85234af'), title='New Title', notes='Original notes', is_completed=False, p...', completion_percentage=0.0, has_children=False, can_have_children_in_column1=True, can_have_children_in_column2=True).created_at
______________ TestTaskItemStateRendering.test_render_active_task ______________
tests/test_task_item.py:149: in test_render_active_task
    task = make_task(
E   TypeError: make_task.<locals>._make_task() got an unexpected keyword argument 'is_archived'
__________________ TestTaskItem.test_task_item_level_classes ___________________
tests/test_ui_components.py:142: in test_task_item_level_classes
    assert "level-0" in item0.classes
E   AssertionError: assert 'level-0' in frozenset()
E    +  where frozenset() = TaskItem().classes
=============================== warnings summary ===============================
../../.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323
../../.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323
  /home/nick/.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/test_app.py::TestActionMethodsTaskOperations::test_action_delete_task_shows_not_implemented_notification
  /home/nick/Projects/taskui-python/tests/test_app.py:739: RuntimeWarning: coroutine 'TaskUI.action_delete_task' was never awaited
    app.action_delete_task()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_app.py::TestAppStateManagement::test_focused_column_id_tracks_current_column
FAILED tests/test_app.py::TestActionMethodsNavigation::test_action_navigate_next_column_cycles_forward
FAILED tests/test_app.py::TestActionMethodsNavigation::test_action_navigate_prev_column_cycles_backward
FAILED tests/test_app.py::TestActionMethodsTaskOperations::test_action_new_child_task_requires_selection
FAILED tests/test_app.py::TestActionMethodsTaskOperations::test_action_edit_task_requires_selection
FAILED tests/test_app.py::TestEventHandlers::test_on_task_creation_modal_task_created_creates_task
FAILED tests/test_app.py::TestEventHandlers::test_on_list_bar_list_selected_switches_list
FAILED tests/test_app.py::TestComponentOrchestration::test_modal_to_database_to_ui_flow
FAILED tests/test_app.py::TestUIRefresh::test_refresh_ui_clears_detail_panel_when_requested
FAILED tests/test_column.py::TestTaskColumnRendering::test_render_mixed_completion_states
FAILED tests/test_column.py::TestTaskColumnTaskUpdates::test_empty_to_populated_state
FAILED tests/test_column.py::TestTaskColumnMessageHandling::test_task_selected_message_preserves_task_data
FAILED tests/test_column.py::TestTaskColumnGrouping::test_group_tasks_by_parent_hierarchical
FAILED tests/test_column2_updates.py::TestColumn2DynamicUpdates::test_make_levels_context_relative_level_0_parent
FAILED tests/test_column2_updates.py::TestColumn2DynamicUpdates::test_make_levels_context_relative_level_1_parent
FAILED tests/test_column2_updates.py::TestColumn2DynamicUpdates::test_make_levels_context_relative_preserves_task_data
FAILED tests/test_column2_updates.py::TestColumn2DynamicUpdates::test_make_levels_context_relative_empty_list
FAILED tests/test_column2_updates.py::TestColumn2DynamicUpdates::test_make_levels_context_relative_multiple_levels
FAILED tests/test_column2_updates.py::TestColumn2SuccessCriteria::test_success_criteria_context_relative_levels
FAILED tests/test_detail_panel.py::TestDetailPanelIntegration::test_different_completion_states
FAILED tests/test_integration_mvp.py::TestMVPIntegration::test_modal_to_database_persistence_flow
FAILED tests/test_integration_mvp.py::TestMVPIntegration::test_nested_task_hierarchy_creation_via_modal
FAILED tests/test_integration_mvp.py::TestMVPIntegration::test_column2_updates_on_task_creation
FAILED tests/test_integration_mvp.py::TestMVPIntegration::test_all_crud_operations_end_to_end
FAILED tests/test_integration_mvp.py::TestMVPIntegration::test_keyboard_navigation_across_columns
FAILED tests/test_integration_mvp.py::TestMVPIntegration::test_column2_updates_on_column1_selection
FAILED tests/test_keyboard_navigation.py::TestKeybindings::test_letter_keybindings_case_insensitive
FAILED tests/test_list_service.py::TestListServiceDelete::test_delete_list_cascades_to_tasks
FAILED tests/test_list_service.py::TestListServiceTaskCounts::test_get_list_with_task_counts
FAILED tests/test_task_editing.py::TestEditTaskServiceIntegration::test_update_task_preserves_other_fields
FAILED tests/test_task_item.py::TestTaskItemStateRendering::test_render_active_task
FAILED tests/test_ui_components.py::TestTaskItem::test_task_item_level_classes
============ 32 failed, 458 passed, 3 warnings in 78.32s (0:01:18) =============
